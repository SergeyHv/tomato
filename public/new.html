<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ… Fast Admin</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4">
<div id="app" class="max-w-xl mx-auto">

  <div class="bg-white p-6 rounded-3xl shadow-xl border mb-6">
    <input v-model="form.title" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ñ€Ñ‚Ğ°" class="w-full p-4 rounded-xl bg-gray-100 mb-4 outline-none">
    
    <button @click="handleSave" 
            class="w-full bg-red-600 text-white py-4 rounded-xl font-bold active:scale-95 transition-all">
      {{ btnText }}
    </button>
  </div>

  <div class="space-y-2">
    <div v-for="p in products" :key="p.id" class="p-4 bg-white rounded-2xl shadow-sm flex justify-between items-center border">
      <span class="font-bold">{{ p.title }}</span>
      <button @click="handleRemove(p.id)" class="text-red-500 p-2">ğŸ—‘</button>
    </div>
  </div>

</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      products: [],
      form: { title: '', category: 'Dwarf' },
      btnText: 'Ğ¡ĞĞ¥Ğ ĞĞĞ˜Ğ¢Ğ¬'
    };
  },
  methods: {
    async load() {
      const r = await fetch('/api/admin/get-products');
      this.products = await r.json();
    },

    // ĞœĞĞšĞ¡Ğ˜ĞœĞĞ›Ğ¬ĞĞ Ğ£ĞŸĞ ĞĞ©Ğ•ĞĞĞĞ• Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ•
    handleSave() {
      if (!this.form.title) return;

      // 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚
      const newId = 't' + Date.now();
      const newProduct = { id: newId, title: this.form.title, category: this.form.category };

      // 2. ĞœĞ“ĞĞĞ’Ğ•ĞĞĞ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
      this.products.unshift(newProduct);
      const titleToSave = this.form.title;
      this.form.title = ''; 
      
      // Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ĞºĞ»Ğ¸Ğº Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑĞµĞºÑƒĞ½Ğ´Ñ‹
      this.btnText = 'âœ… Ğ“ĞĞ¢ĞĞ’Ğ';
      setTimeout(() => { this.btnText = 'Ğ¡ĞĞ¥Ğ ĞĞĞ˜Ğ¢Ğ¬'; }, 500);

      // 3. ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ Ğ‘Ğ•Ğ— AWAIT (Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ)
      // ĞœÑ‹ Ğ½Ğµ Ğ¶Ğ´ĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ½ĞµÑ‚
      fetch('/api/admin/add-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          id: newId, 
          title: titleToSave, 
          category: 'Dwarf', 
          password: 'khvalla74' 
        })
      });
    },

    handleRemove(id) {
      // 1. ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ°
      this.products = this.products.filter(p => p.id !== id);

      // 2. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Â«Ğ²Ğ´Ğ¾Ğ³Ğ¾Ğ½ĞºÑƒÂ»
      fetch('/api/admin/delete-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, password: 'khvalla74' })
      });
    }
  },
  mounted() {
    this.load();
  }
}).mount('#app');
</script>
</body>
</html>
