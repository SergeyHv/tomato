<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üçÖ MINIMAL ADMIN</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
<div id="app" class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-10">

  <section>
    <h2 class="text-xl font-bold mb-4">–°–æ—Ä—Ç–∞ ({{ products.length }})</h2>
    <div class="space-y-2">
      <div v-for="p in products" :key="p.id" class="p-3 bg-white shadow rounded-xl flex justify-between items-center">
        <div>
          <div class="font-bold">{{ p.title }}</div>
          <div class="text-xs text-gray-400">{{ p.category }}</div>
        </div>
        <button @click="remove(p.id)" class="text-red-500 font-bold p-2">–£–î–ê–õ–ò–¢–¨</button>
      </div>
    </div>
  </section>

  <section>
    <div class="bg-white p-6 rounded-2xl shadow-lg sticky top-5">
      <h2 class="text-xl font-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç</h2>
      <input v-model="form.title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="w-full p-3 border rounded-xl mb-3 outline-none focus:ring-2 focus:ring-red-500">
      
      <select v-model="form.category" class="w-full p-3 border rounded-xl mb-3">
        <option value="Dwarf">–ì–Ω–æ–º</option>
        <option value="Det">–ù–∏–∑–∫–∏–π</option>
        <option value="Indet">–í—ã—Å–æ–∫–∏–π</option>
      </select>

      <button @click="add" class="w-full bg-red-600 text-white py-4 rounded-xl font-bold hover:bg-red-700 active:scale-95 transition">
        –î–û–ë–ê–í–ò–¢–¨ –ú–ì–ù–û–í–ï–ù–ù–û
      </button>

      <p class="mt-4 text-[10px] text-gray-400 uppercase tracking-widest text-center">
        –°—Ç–∞—Ç—É—Å: {{ status }}
      </p>
    </div>
  </section>

</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      products: [],
      status: '–ì–æ—Ç–æ–≤',
      form: { title: '', category: 'Dwarf' }
    };
  },
  methods: {
    // 1. –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ü–†–ò –°–¢–ê–†–¢–ï
    async load() {
      const r = await fetch('/api/admin/get-products');
      this.products = await r.json();
    },

    // 2. –ú–ì–ù–û–í–ï–ù–ù–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï
    add() {
      if (!this.form.title) return;
      this.status = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ...';

      const newId = 't' + Date.now();
      const newProduct = { id: newId, title: this.form.title, category: this.form.category };

      // --- –ì–õ–ê–í–ù–û–ï: –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–ª—è–µ–º —ç–∫—Ä–∞–Ω! ---
      this.products.unshift(newProduct);
      const dataToSave = { ...newProduct, password: 'khvalla74' };
      
      // –û—á–∏—â–∞–µ–º –≤–≤–æ–¥ —Å—Ä–∞–∑—É
      this.form.title = '';

      // --- –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ë–ï–ó AWAIT (–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞) ---
      fetch('/api/admin/add-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dataToSave)
      }).then(() => {
        this.status = '–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
      }).catch(() => {
        this.status = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏, –Ω–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –≤—Å—ë –µ—Å—Ç—å';
      });
    },

    // 3. –ú–ì–ù–û–í–ï–ù–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï
    remove(id) {
      this.status = '–£–¥–∞–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ...';
      // –°–Ω–∞—á–∞–ª–∞ —É–±–∏—Ä–∞–µ–º —Å –≥–ª–∞–∑
      this.products = this.products.filter(p => p.id !== id);

      // –ü–æ—Ç–æ–º —É–¥–∞–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ
      fetch('/api/admin/delete-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, password: 'khvalla74' })
      }).then(() => {
        this.status = '–£–¥–∞–ª–µ–Ω–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã';
      });
    }
  },
  mounted() {
    this.load();
  }
}).mount('#app');
</script>
</body>
</html>
