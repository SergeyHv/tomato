<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üçÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ê–¥–º–∏–Ω–∫–∞</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4 font-sans">
<div id="app" class="max-w-md mx-auto">

  <h1 class="text-2xl font-black text-red-600 mb-6 uppercase tracking-tighter">üçÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h1>

  <div class="bg-white p-6 rounded-3xl shadow-xl mb-8 border border-red-50">
    <input v-model="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ—Ä—Ç–∞..." 
           class="w-full p-4 rounded-2xl bg-gray-50 border-none outline-none focus:ring-2 focus:ring-red-500 text-lg mb-4">
    
    <button @click="fastAdd" :disabled="!title"
            class="w-full bg-red-600 text-white py-4 rounded-2xl font-bold text-lg active:scale-95 transition-all shadow-lg shadow-red-200">
      –î–û–ë–ê–í–ò–¢–¨ –°–ï–ô–ß–ê–°
    </button>
  </div>

  <div class="space-y-3">
    <div v-for="p in products" :key="p.id" 
         class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center animate-in fade-in duration-300">
      <div>
        <div class="font-bold text-gray-800">{{ p.title }}</div>
        <div class="text-[10px] text-gray-400 uppercase">{{ p.id }}</div>
      </div>
      <button @click="fastRemove(p.id)" class="bg-gray-50 text-red-500 w-10 h-10 rounded-xl flex items-center justify-center hover:bg-red-50 transition-colors">
        üóë
      </button>
    </div>
  </div>

  <div v-if="syncing" class="fixed bottom-4 right-4 bg-black text-white px-4 py-2 rounded-full text-xs animate-pulse shadow-2xl">
    ‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π...
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      products: [],
      title: '',
      syncing: false
    };
  },
  methods: {
    // –ó–ê–ì–†–£–ó–ö–ê
    async load() {
      try {
        const r = await fetch('/api/admin/get-products');
        this.products = await r.json();
      } catch (e) { console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"); }
    },

    // –ú–ì–ù–û–í–ï–ù–ù–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï
    fastAdd() {
      const newObj = { 
        id: 't' + Date.now(), 
        title: this.title, 
        category: 'Dwarf' 
      };

      // –®–ê–ì 1: –°–†–ê–ó–£ –ù–ê –≠–ö–†–ê–ù (–Ω–µ –∂–¥–µ–º —Å–µ—Ä–≤–µ—Ä)
      this.products.unshift(newObj);
      const savedTitle = this.title;
      this.title = ''; 
      this.syncing = true;

      // –®–ê–ì 2: –í –§–û–ù–ï –í –¢–ê–ë–õ–ò–¶–£
      fetch('/api/admin/add-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          id: newObj.id, 
          title: savedTitle, 
          category: 'Dwarf', 
          password: 'khvalla74' 
        })
      }).finally(() => {
        this.syncing = false;
        // –ú–æ–∂–Ω–æ –Ω–µ –¥–µ–ª–∞—Ç—å load(), —á—Ç–æ–±—ã –Ω–µ ¬´–ø—Ä—ã–≥–∞–ª¬ª —Å–ø–∏—Å–æ–∫
      });
    },

    // –ú–ì–ù–û–í–ï–ù–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï
    fastRemove(id) {
      // –®–ê–ì 1: –°–†–ê–ó–£ –£–ë–ò–†–ê–ï–ú –° –≠–ö–†–ê–ù–ê
      this.products = this.products.filter(p => p.id !== id);
      this.syncing = true;

      // –®–ê–ì 2: –í –§–û–ù–ï –ò–ó –¢–ê–ë–õ–ò–¶–´
      fetch('/api/admin/delete-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, password: 'khvalla74' })
      }).finally(() => {
        this.syncing = false;
      });
    }
  },
  mounted() {
    this.load();
  }
}).mount('#app');
</script>
</body>
</html>
